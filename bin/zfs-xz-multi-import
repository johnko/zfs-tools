#!/bin/sh

if [ -z "${2}" ]; then
    echo "Usage: $0  input_folder  pool"
    exit 1
fi

#DRYRUN="-n"

OUTPUTDIR="${1}"

RECVPOOL="${2}"

mkdir ${OUTPUTDIR}/.done

for i in $( ls ${OUTPUTDIR} ) ; do

    echo "importing ${OUTPUTDIR}/${i}"

    if [ "x" = "x${DRYRUN}" ]; then
        zfs-xz-import ${OUTPUTDIR}/${i} ${RECVPOOL} && rm ${OUTPUTDIR}/${i} # mv ${OUTPUTDIR}/${i} ${OUTPUTDIR}/.done/${i}
    else
        echo "DRYRUN, so skipping"
    fi

done
