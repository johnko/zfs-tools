#!/bin/sh

if [ -z "${2}" ]; then
    echo "Usage: $0  input_folder  pool"
    exit 1
fi

#DRYRUN="-n"

OUTPUTDIR="${1}"

RECVPOOL="${2}"

PREVSNAP=""
for i in $( ls ${OUTPUTDIR} ) ; do

    echo "importing ${OUTPUTDIR}/${i}"

    if [ "x" = "x${DRYRUN}" ]; then
        zfs-xz-import ${OUTPUTDIR}/${i} ${RECVPOOL}
        mkdir ${OUTPUTDIR}/.done
        mv ${OUTPUTDIR}/${i} ${OUTPUTDIR}/.done/${i}
    else
        echo "DRYRUN, so skipping"
    fi

done
